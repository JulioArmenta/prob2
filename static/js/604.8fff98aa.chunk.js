"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[604],{375:function(e,t,n){n.d(t,{i$:function(){return c}});var r=n(74165),i=n(15861),o=n(31881),s=n.n(o),l=n(50804),a=n(47444),c=function(){return function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s().get("".concat("https://dental-app-backend.herokuapp.com","/api/treatments")).then((function(e){t(d(e.data))})).catch((function(e){t((0,a.sT)("Ha ocurrido un problema al cargar los registros.")),console.log(e)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},d=function(e){return{type:l.V.getTreatments,payload:e}}},94604:function(e,t,n){n.r(t),n.d(t,{default:function(){return ae}});var r=n(29439),i=n(97241),o=n(82277),s=n(51204),l=n(99881),a=n(47313),c=n(1084),d=n(42251),u=n(29077),m=n(20611),h=n(51246),x=n(375),p=(n(98456),n(77166)),g=n(1413),j=n(45987),Z=n(94469),f=n(33604),v=n(9019),b=n(19536),y=n(22260),C=n(61113),I=n(96467),_=n(4117),F=n(24193),k=n(87913),w=n(7501),T=n(47131),A=n(42695),z=n(8047),S=n(93433),q=n(5211),D=n(21144),E=n(14636),P=n(1550),V=n(23306),W=n(88797),O=n(15480),B=n(66835),H=n(57861),L=n(67478),R=n(51629),$=n(23477),M=n(24076),G=n(82295),N=n(52376),J=n(81058),Q=n(46417);function U(e){return"$".concat(parseInt(e).toFixed(2))}function K(e){var t=e.values,n=e.setOpenTreatmentDetail,r=e.setTreatmentDetail,i=((0,c.v9)((function(e){return e.products})),(0,N.Z)((function(e){return{root:{fontWeight:"bold"}}}))(L.Z)),o=(0,N.Z)((function(e){return{root:{fontWeight:"bold",fontSize:"17px"}}}))(L.Z);return 0!==t.sale_details.length?(0,Q.jsx)(G.Z,{sx:{width:"100%",overflow:"hidden"},children:(0,Q.jsx)(R.Z,{children:(0,Q.jsxs)(B.Z,{children:[(0,Q.jsxs)($.Z,{children:[(0,Q.jsxs)(M.Z,{style:{backgroundColor:"rgba(88,183,244,0.5)"},children:[(0,Q.jsx)(o,{align:"center",colSpan:4,children:"Detalle"}),(0,Q.jsx)(o,{align:"right",children:"Precio"})]}),(0,Q.jsxs)(M.Z,{children:[(0,Q.jsx)(i,{children:"Descripci\xf3n"}),(0,Q.jsx)(i,{align:"right",children:"Cantidad"}),(0,Q.jsx)(i,{align:"right",children:"Precio"}),(0,Q.jsx)(i,{align:"right",children:"Descuento"}),(0,Q.jsx)(i,{align:"right",children:"Total Registro"})]})]}),(0,Q.jsxs)(H.Z,{children:[t.sale_details.map((function(e,t){return(0,Q.jsxs)(M.Z,{tabIndex:-1,children:[(0,Q.jsx)(L.Z,{children:"Abono Tratamiento"==e.product.name?(0,Q.jsxs)("div",{children:[e.product.name,(0,Q.jsx)(y.Z,{title:"Ver detalle",children:(0,Q.jsx)(T.Z,{onClick:function(t){return function(e){r(e),n(!0)}(e)},style:{width:"30px",height:"30px",borderRadius:20,backgroundColor:"rgba(54, 163, 234,0)",color:"white",margin:5},children:(0,Q.jsx)(J.Z,{style:{color:"black"}})})})]}):e.product.name}),(0,Q.jsx)(L.Z,{align:"right",children:e.quantity}),(0,Q.jsx)(L.Z,{align:"right",children:U(e.price)}),(0,Q.jsx)(L.Z,{align:"right",children:e.discount?"".concat(e.discount,"%"):"-"}),(0,Q.jsx)(L.Z,{align:"right",children:U((i=e.quantity,o=e.price,s=e.discount,s?i*o-i*o*(s/100):i*o))})]},t);var i,o,s})),(0,Q.jsxs)(M.Z,{children:[(0,Q.jsx)(L.Z,{rowSpan:3}),(0,Q.jsx)(i,{colSpan:2,align:"right",children:"Subtotal"}),(0,Q.jsx)(L.Z,{colSpan:1}),(0,Q.jsx)(L.Z,{align:"right",children:U(t.subtotal)})]}),(0,Q.jsxs)(M.Z,{children:[(0,Q.jsx)(i,{colSpan:2,align:"right",children:"Total"}),(0,Q.jsx)(L.Z,{colSpan:1}),(0,Q.jsx)(L.Z,{align:"right",children:U(t.total)})]})]})]})})}):null}var X={quantity:1,price:"",discount:"",employeeId:"",productId:"",product:null,payment:"",treatmentId:"",comments:""};var Y=function(e){var t,n,r=e.setFormValues,i=e.formValues,o=i.sale_details.map((function(e){return e.discount?e.quantity*e.price-e.quantity*e.price*(e.discount/100):e.quantity*e.price})).reduce((function(e,t){return e+t}),0),s=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,n=(0,g.Z)({},h);if("product"in t&&(n.product=t.product?"":"Este campo es requerido"),"quantity"in t&&(n.quantity=t.quantity?"":"Este campo es requerido"),"treatmentId"in t&&(n.treatmentId=t.treatmentId||"Abono Tratamiento"!=(null===(e=d.product)||void 0===e?void 0:e.name)?"":"Este campo es requerido"),"price"in t&&(n.price=t.price>0?"":"El abono debe ser mayor a 0"),x((0,g.Z)({},n)),t==d)return Object.values(n).every((function(e){return""==e}))},l=(0,k.c)(X,!0,s),d=l.values,u=l.setValues,m=l.handleInputChange,h=(l.resetForm,l.errors),x=l.setErrors,p=(0,c.v9)((function(e){return e.products})),j=(0,c.v9)((function(e){return e.treatments}));return(0,a.useEffect)((function(){d.product&&u((0,g.Z)((0,g.Z)({},d),{},{price:d.product.sale_price,productId:d.product.id}))}),[d.product]),(0,a.useEffect)((function(){i.sale_details&&r((0,g.Z)((0,g.Z)({},i),{},{total:o,subtotal:o}))}),[i.sale_details]),(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(D.Z,{item:!0,xs:12,sm:6,children:(0,Q.jsx)(A.Z,{name:"product",size:"small",value:d.product,isOptionEqualToValue:function(e,t){return e.id===t.id},id:"combo-box-demo",options:p.filter((function(e){return e.status&&"Tratamientos"!=e.product_category.name})),onChange:function(e,t){m({target:{value:t,name:"product"}})},getOptionLabel:function(e){return"".concat(e.id," ").concat(e.name," - ").concat(e.product_category.name)},renderInput:function(e){return(0,Q.jsx)(z.Z,(0,g.Z)((0,g.Z)({},e),{},{label:"Productos"},h.product&&{error:!0,helperText:h.product}))}})}),(0,Q.jsx)(D.Z,{item:!0,sm:6,xs:12}),"Abono Tratamiento"==(null===(t=d.product)||void 0===t?void 0:t.name)?j.length>0&&(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(D.Z,{item:!0,xs:12,sm:4,children:(0,Q.jsxs)(P.Z,(0,g.Z)((0,g.Z)({variant:"outlined",size:"small"},h.treatmentId&&{error:!0}),{},{children:[(0,Q.jsx)(V.Z,{children:"Tratamientos"}),(0,Q.jsxs)(W.Z,{label:"Tratamientos",name:"treatmentId",value:d.treatmentId||"",onChange:m,children:[(0,Q.jsx)(E.Z,{value:"",children:"Ninguno"}),j.filter((function(e){var t;return e.customerId==(null===(t=i.customer)||void 0===t?void 0:t.id)&&"Pendiente"==e.status})).map((function(e,t){return(0,Q.jsxs)(E.Z,{value:e.id,children:[e.id," ",e.product.name]},e.id)}))]}),h.treatmentId&&(0,Q.jsx)(O.Z,{children:h.treatmentId})]}))}),(0,Q.jsx)(D.Z,{item:!0,xs:12,sm:2,children:(0,Q.jsx)(w.Z.FormInput,{size:"small",label:"Abono",name:"price",value:d.price,type:"number",onChange:m,error:h.price})}),(0,Q.jsx)(D.Z,{item:!0,xs:12,sm:5,children:(0,Q.jsx)(w.Z.FormInput,{size:"small",label:"Comentarios",name:"comments",multiline:!0,value:d.comments,onChange:m})})]}):(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(D.Z,{item:!0,xs:4,sm:4,children:(0,Q.jsx)(w.Z.FormInput,{size:"small",label:"Cantidad",name:"quantity",value:d.quantity,type:"number",onChange:m,error:h.quantity})}),(0,Q.jsx)(D.Z,{item:!0,xs:4,sm:4,children:(0,Q.jsx)(w.Z.FormInput,{size:"small",label:"Descuento",name:"discount",value:d.discount,type:"number",onChange:m})}),(0,Q.jsx)(D.Z,{item:!0,xs:4,sm:3,children:(0,Q.jsx)(w.Z.FormInput,{size:"small",label:"Precio",name:"price",value:d.price,type:"number",onChange:m,disabled:"Abono Tratamiento"!=(null===(n=d.product)||void 0===n?void 0:n.name)})})]}),(0,Q.jsx)(D.Z,{item:!0,xs:12,sm:1,style:{alignSelf:"center"},children:(0,Q.jsx)(T.Z,{onClick:function(){s()&&("Abono Tratamiento"!=d.product.name?r((0,g.Z)((0,g.Z)({},i),{},{sale_details:[].concat((0,S.Z)(i.sale_details),[d])})):r((0,g.Z)((0,g.Z)({},i),{},{sale_details:[].concat((0,S.Z)(i.sale_details),[d]),treatment_details:[].concat((0,S.Z)(i.treatment_details),[{payment:d.price,treatmentId:d.treatmentId,comments:d.comments}])})),u(X))},style:{width:"100%",height:"40px",borderRadius:20,backgroundColor:"rgb(54, 163, 234)",marginBottom:5},children:(0,Q.jsx)(q.Z,{style:{color:"white"}})})})]})},ee=n(36191),te=n(11198),ne=n(16577),re=["children","onClose"],ie=(0,ne.Z)(Z.Z)((function(e){var t=e.theme;return{"& .MuiDialogContent-root":{padding:t.spacing(2)},"& .MuiDialogActions-root":{padding:t.spacing(1)}}})),oe=function(e){var t=e.children,n=e.onClose,r=(0,j.Z)(e,re);return(0,Q.jsx)(f.Z,(0,g.Z)((0,g.Z)({sx:{m:0,p:2,backgroundColor:"#36A3EA",color:"white"}},r),{},{children:(0,Q.jsxs)("div",{style:{display:"flex"},children:[t,n?(0,Q.jsx)(T.Z,{"aria-label":"close",onClick:n,sx:{position:"absolute",color:function(e){return e.palette.grey[500]}},children:(0,Q.jsx)(te.Z,{})}):null]})}))},se=function(e){var t,n,i,o,s,l=(0,a.useState)(!1),d=(0,r.Z)(l,2),u=d[0],m=d[1],h=(0,a.useState)(!1),x=(0,r.Z)(h,2),p=x[0],j=x[1],Z=(0,a.useState)(null),f=(0,r.Z)(Z,2),S=f[0],q=f[1],D=(0,c.v9)((function(e){return e.branches})),E=(0,c.v9)((function(e){return e.customers})),P=(0,c.v9)((function(e){return e.sales})),V=(0,c.v9)((function(e){return e.treatments})),W=(0,c.v9)((function(e){return e.auth})).profile,O={id:0,folio:"SV-".concat(P.length+1),subtotal:"",createdAt:new Date,total:"",userId:W.id,branchId:W.branchId,customerId:"",customer:null,sale_details:[],treatment_details:[]},B=e.addOrEdit,H=(e.cancelForm,e.setOpenAlert),L=(0,k.c)(O),R=L.values,$=L.setValues,M=L.handleInputChange,G=L.resetForm,N=function(){m(!1)},J=function(){j(!1)};return(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(k.l,{onSubmit:function(e){e.preventDefault(),0===R.sale_details.length?H(!0):m(!0)},children:(0,Q.jsxs)(v.ZP,{container:!0,rowSpacing:0,columnSpacing:3,style:{width:"calc(100% + 24px)"},children:[(0,Q.jsx)(v.ZP,{item:!0,xs:12,sm:4,children:(0,Q.jsxs)("h5",{style:{fontWeight:"bold",textAlign:"center"},children:["Usuario:"," ",(0,Q.jsx)("span",{style:{fontSize:"15px",fontWeight:"normal"},children:W.name})]})}),(0,Q.jsx)(v.ZP,{item:!0,xs:12,sm:4}),(0,Q.jsx)(v.ZP,{item:!0,xs:12,sm:4,children:(0,Q.jsxs)("h5",{style:{fontWeight:"bold",textAlign:"center"},children:["Fecha:"," ",(0,Q.jsx)("span",{style:{fontSize:"15px",fontWeight:"normal"},children:new Date(R.createdAt).toLocaleDateString()})]})}),(0,Q.jsx)(v.ZP,{item:!0,xs:12,children:(0,Q.jsx)(b.Z,{light:!1,orientation:"horizontal",flexItem:!0,style:{margin:5,height:"4px",color:"#36A3EA",opacity:1}})}),(0,Q.jsx)(v.ZP,{item:!0,xs:12,children:(0,Q.jsx)("h5",{style:{marginTop:5},children:"Datos Generales"})}),(0,Q.jsx)(v.ZP,{item:!0,xs:12,sm:6,children:(0,Q.jsx)(A.Z,{name:"customer",value:R.customer,isOptionEqualToValue:function(e,t){return e.id===t.id},id:"combo-box-demo",options:E.filter((function(e){return e.status})),onChange:function(e,t){return M({target:{value:t,name:"customer"}})},getOptionLabel:function(e){return"".concat(e.id," ").concat(e.name," ").concat(e.lastname," - ").concat(e.phone)},renderInput:function(e){return(0,Q.jsx)(z.Z,(0,g.Z)((0,g.Z)({required:!0},e),{},{label:"Cliente"}))}})}),(0,Q.jsx)(v.ZP,{item:!0,xs:12,sm:6,children:D.length>0&&(0,Q.jsx)(w.Z.FormSelect,{name:"branchId",label:"Sucursal",value:R.branchId||"",onChange:M,items:D.filter((function(e){return e.status})),required:!0})}),(0,Q.jsx)(v.ZP,{item:!0,xs:6,sm:6,children:(0,Q.jsx)("h5",{children:"Detalle Venta"})}),(0,Q.jsx)(v.ZP,{item:!0,xs:6,sm:6,style:{textAlign:"right"},children:(0,Q.jsx)(y.Z,{title:"Limpiar Detalle",children:(0,Q.jsx)(T.Z,{style:{width:"35px",height:"35px",borderRadius:20,backgroundColor:"rgb(54, 163, 234)",color:"white"},onClick:function(){$((0,g.Z)((0,g.Z)({},R),{},{sale_details:[]}))},children:(0,Q.jsx)(ee.Z,{})})})}),(0,Q.jsx)(Y,{setFormValues:$,formValues:R}),(0,Q.jsx)(v.ZP,{item:!0,xs:12,children:(0,Q.jsx)(K,{values:R,setOpenTreatmentDetail:j,setTreatmentDetail:q})}),(0,Q.jsxs)(v.ZP,{item:!0,xs:12,style:{textAlign:"right",paddingTop:5},children:[(0,Q.jsx)(w.Z.FormButton,{variant:"text",color:"default",size:"large",text:"Limpiar",onClick:function(){G()},style:{pointerEvents:"auto"}}),(0,Q.jsx)(w.Z.FormButton,{variant:"contained",color:"primary",type:"submit",size:"large",text:"Registrar Venta"})]})]})}),R.customer&&R.total?(0,Q.jsxs)(ie,{onClose:N,"aria-labelledby":"customized-dialog-title",open:u,children:[(0,Q.jsx)(oe,{id:"customized-dialog-title",onClose:N,children:(0,Q.jsx)(C.Z,{variant:"h6",component:"div",style:{flexGrow:1},children:"Confirmaci\xf3n de Venta"})}),(0,Q.jsxs)(I.Z,{dividers:!0,children:[(0,Q.jsx)(C.Z,{gutterBottom:!0,variant:"h6",style:{fontWeight:"bold"},children:"Antes de continuar favor de validar la siguiente informaci\xf3n:"}),(0,Q.jsxs)(C.Z,{gutterBottom:!0,children:[(0,Q.jsx)("span",{style:{fontWeight:"bold"},children:"Cliente: "})," ",R.customer.name," ",R.customer.lastname," - ",R.customer.phone]}),(0,Q.jsxs)(C.Z,{gutterBottom:!0,children:[(0,Q.jsx)("span",{style:{fontWeight:"bold"},children:"Total: "})," $"," ",parseFloat(R.total).toFixed(2)]}),(0,Q.jsxs)(C.Z,{gutterBottom:!0,children:[(0,Q.jsx)("span",{style:{fontWeight:"bold"},children:"Tipo de Pago: "})," Efectivo"]})]}),(0,Q.jsxs)(_.Z,{children:[(0,Q.jsx)(F.Z,{autoFocus:!0,onClick:N,children:"Cancelar"}),(0,Q.jsx)(F.Z,{autoFocus:!0,onClick:function(){B(R,G),m(!1)},variant:"contained",children:"Confirmar"})]})]}):null,(0,Q.jsxs)(ie,{onClose:J,"aria-labelledby":"customized-dialog-title",open:p,children:[(0,Q.jsx)(oe,{id:"customized-dialog-title",onClose:J,children:(0,Q.jsx)(C.Z,{variant:"h6",component:"div",style:{flexGrow:1},children:"Detalle Abono"})}),(0,Q.jsxs)(I.Z,{dividers:!0,children:[(0,Q.jsxs)(C.Z,{gutterBottom:!0,children:[(0,Q.jsx)("span",{style:{fontWeight:"bold"},children:"Cliente: "})," ",null===(t=R.customer)||void 0===t?void 0:t.name," ",null===(n=R.customer)||void 0===n?void 0:n.lastname," - ",null===(i=R.customer)||void 0===i?void 0:i.phone]}),(0,Q.jsxs)(C.Z,{gutterBottom:!0,children:[(0,Q.jsx)("span",{style:{fontWeight:"bold"},children:"Tratamiento: "}),null===(o=V.find((function(e){return e.id==(null===S||void 0===S?void 0:S.treatmentId)})))||void 0===o||null===(s=o.product)||void 0===s?void 0:s.name]}),(0,Q.jsxs)(C.Z,{gutterBottom:!0,children:[(0,Q.jsx)("span",{style:{fontWeight:"bold"},children:"Comentarios: "})," ",(null===S||void 0===S?void 0:S.comments)||"-"]}),(0,Q.jsxs)(C.Z,{gutterBottom:!0,children:[(0,Q.jsx)("span",{style:{fontWeight:"bold"},children:"Abono: "})," $"," ",parseFloat(null===S||void 0===S?void 0:S.price).toFixed(2)]})]}),(0,Q.jsx)(_.Z,{children:(0,Q.jsx)(F.Z,{autoFocus:!0,onClick:J,children:"Cerrar"})})]})]})},le=(0,i.Z)((function(e){return{pageContent:{padding:e.spacing(3)},searchInput:{width:"75%"}}})),ae=function(){var e=(0,c.I0)(),t=(0,a.useState)(!1),n=(0,r.Z)(t,2),i=n[0],g=n[1],j=le(),Z=(0,c.v9)((function(e){return e.branches})),f=(0,c.v9)((function(e){return e.customers})),v=(0,c.v9)((function(e){return e.products})),b=(0,c.v9)((function(e){return e.treatments}));(0,a.useEffect)((function(){0===v.length&&e((0,m.Dg)()),0===Z.length&&e((0,d.Qq)()),0===f.length&&e((0,u.JL)()),0===b.length&&e((0,x.i$)())}),[]);var y=function(e,t){"clickaway"!==t&&g(!1)};return(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(p.T,{title:"Registrar Venta"}),(0,Q.jsx)(o.Z,{className:j.pageContent,children:(0,Q.jsx)(se,{addOrEdit:function(t,n){t.customerId=t.customer.id,Object.keys(t).forEach((function(e){""===t[e]&&(t[e]=null)})),Object.keys(t.sale_details).forEach((function(e){Object.keys(t.sale_details[e]).forEach((function(n){""===t.sale_details[e][n]&&(t.sale_details[e][n]="discount"===n?0:null)}))})),0===t.id&&(delete t.id,console.log(t),e((0,h.WI)(t))),n()},setOpenAlert:g})}),(0,Q.jsx)(s.Z,{open:i,autoHideDuration:2e3,onClose:y,children:(0,Q.jsx)(l.Z,{onClose:y,severity:"warning",sx:{width:"100%",alignItems:"center"},style:{backgroundColor:"rgb(211, 47, 47)",color:"white",fontWeight:"bold"},children:"Agregar al menos un producto !"})})]})}},81058:function(e,t,n){var r=n(95318);t.Z=void 0;var i=r(n(45045)),o=n(46417),s=(0,i.default)((0,o.jsx)("path",{d:"M16 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V8l-5-5zM7 7h5v2H7V7zm10 10H7v-2h10v2zm0-4H7v-2h10v2zm-2-4V5l4 4h-4z"}),"Feed");t.Z=s}}]);